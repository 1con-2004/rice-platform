# FarmerSettings 功能测试说明

## 测试环境
- 前端：http://localhost:3002
- 后端：http://localhost:3001
- 数据库：MySQL (localhost:3306, rice_platform)

## 测试用户账户
以下用户已经在数据库中创建，都可以用来测试：

| 用户名 | 密码 | 姓名 | 手机号 | 地区 |
|--------|------|------|--------|------|
| newuser | 123456 | 张三 | 13812345678 | 江苏省苏州市吴中区 |
| test123 | 123456 | 李四 | 13987654321 | 浙江省杭州市西湖区 |
| testuser2 | 123456 | 王五 | 13666666666 | 山东省济南市历下区 |
| 17324042932 | 123456 | 赵六 | 13555555555 | 河南省郑州市中原区 |

## 测试步骤

### 1. 启动服务
```bash
# 启动后端 (在backend目录)
pnpm dev

# 启动前端 (在frontend目录，新终端)
npm run dev
```

### 2. 登录测试
1. 访问：http://localhost:3002/farmer/login
2. 使用任意测试账户登录（如：newuser / 123456）
3. 验证登录成功跳转

### 3. 访问设置页面
1. 登录后访问：http://localhost:3002/farmer/settings
2. 验证页面加载用户信息和农户档案

### 4. 测试功能

#### A. 查看用户信息
- [ ] 用户概览卡片显示正确的用户名
- [ ] 注册时间显示正确
- [ ] 账户状态显示为"正常"

#### B. 查看农户档案
- [ ] 真实姓名显示正确
- [ ] 联系电话显示正确  
- [ ] 农场地理位置显示正确
- [ ] 农场详细信息显示正确
- [ ] 头像图片区域存在（即使为空）

#### C. 编辑档案信息
1. **编辑姓名**
   - [ ] 点击姓名旁的"编辑"按钮
   - [ ] 弹窗打开，标题为"编辑真实姓名"
   - [ ] 输入新姓名，点击保存
   - [ ] 验证保存成功并更新显示

2. **编辑手机号**
   - [ ] 点击联系电话旁的"编辑"按钮
   - [ ] 输入有效的11位手机号
   - [ ] 验证保存成功
   - [ ] 测试输入无效手机号的错误提示

3. **编辑农场位置**
   - [ ] 点击农场地理位置旁的"编辑"按钮
   - [ ] 输入新地址，保存
   - [ ] 验证更新成功

4. **编辑农场信息**
   - [ ] 点击农场详细信息旁的"编辑"按钮
   - [ ] 应该显示多行文本输入框
   - [ ] 输入较长的农场描述，保存
   - [ ] 验证更新成功

#### D. 头像上传测试
1. **选择头像文件**
   - [ ] 点击头像图片旁的"编辑"按钮
   - [ ] 弹窗显示文件上传组件
   - [ ] 选择JPG或PNG图片文件（小于2MB）
   - [ ] 验证图片预览显示

2. **上传限制测试**
   - [ ] 测试上传非图片文件，验证错误提示
   - [ ] 测试上传大于2MB的文件，验证错误提示
   - [ ] 测试上传正确格式的图片，验证成功

#### E. 密码修改测试
1. **正确修改密码**
   - [ ] 点击"修改密码"按钮
   - [ ] 输入当前密码：123456
   - [ ] 输入新密码（至少6位）
   - [ ] 确认新密码
   - [ ] 验证修改成功

2. **密码验证测试**
   - [ ] 测试当前密码错误的情况
   - [ ] 测试新密码少于6位的情况
   - [ ] 测试两次新密码不一致的情况

#### F. 退出登录测试
- [ ] 点击"退出登录"按钮
- [ ] 确认弹窗出现
- [ ] 点击确定后跳转到登录页
- [ ] 验证token已清除（尝试直接访问设置页面应该跳转到登录页）

## API测试（可选）

### 使用curl测试API端点：

```bash
# 1. 登录获取token
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"account":"newuser","password":"123456"}'

# 2. 使用返回的token访问用户档案
curl -X GET http://localhost:3001/api/user/profile \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# 3. 更新农户档案
curl -X PUT http://localhost:3001/api/farmer/profile \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{"name":"新姓名","phone":"13999999999"}'
```

## 预期结果
- ✅ 所有功能正常工作
- ✅ 数据能正确保存到数据库
- ✅ 错误处理恰当
- ✅ 用户体验流畅
- ✅ 安全验证有效

## 故障排除

### 常见问题：
1. **无法获取用户信息** → 检查用户是否已登录，token是否有效
2. **保存失败** → 检查后端日志，确认数据库连接
3. **图片上传失败** → 检查文件格式和大小限制
4. **页面跳转问题** → 检查路由守卫是否正常工作